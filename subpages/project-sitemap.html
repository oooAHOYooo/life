<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Project Sitemap - LifeOS</title>
        <link rel="stylesheet" href="../styles.css">
        <style>
        .back-link {
            display: inline-block;
            margin-bottom: 20px;
            color: #3498db;
            text-decoration: none;
            font-weight: 500;
        }
        .back-link:hover {
            text-decoration: underline;
        }
        
        .sitemap-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .sitemap-section {
            margin-bottom: 50px;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .sitemap-section h2 {
            font-size: 1.8rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #3498db;
        }
        
        .hierarchy-tree {
            position: relative;
            margin: 20px 0;
        }
        
        .hierarchy-node {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 15px 20px;
            margin: 10px 0;
            position: relative;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .hierarchy-node:hover {
            background: #e9ecef;
            transform: translateX(5px);
            border-color: #3498db;
        }
        
        .hierarchy-node.main {
            background: #e3f2fd;
            border-color: #2196f3;
            font-weight: 600;
        }
        
        .hierarchy-node.sub {
            margin-left: 30px;
            background: #f1f8e9;
            border-color: #8bc34a;
        }
        
        .hierarchy-node.sub-sub {
            margin-left: 60px;
            background: #fff3e0;
            border-color: #ff9800;
        }
        
        .hierarchy-node.sub-sub-sub {
            margin-left: 90px;
            background: #fce4ec;
            border-color: #e91e63;
        }
        
        .node-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .node-description {
            color: #7f8c8d;
            font-size: 0.9rem;
            margin-bottom: 8px;
        }
        
        .node-meta {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .node-tag {
            background: #ecf0f1;
            color: #2c3e50;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .node-tag.status-active {
            background: #d4edda;
            color: #155724;
        }
        
        .node-tag.status-planning {
            background: #fff3cd;
            color: #856404;
        }
        
        .node-tag.status-completed {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        .node-tag.priority-high {
            background: #f8d7da;
            color: #721c24;
        }
        
        .node-tag.priority-medium {
            background: #fff3cd;
            color: #856404;
        }
        
        .node-tag.priority-low {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        .node-link {
            color: #3498db;
            text-decoration: none;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .node-link:hover {
            text-decoration: underline;
        }
        
        .connection-line {
            position: absolute;
            left: -20px;
            top: 50%;
            width: 20px;
            height: 2px;
            background: #bdc3c7;
        }
        
        .connection-line::before {
            content: '';
            position: absolute;
            left: 0;
            top: -8px;
            width: 2px;
            height: 16px;
            background: #bdc3c7;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            border-left: 4px solid #3498db;
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: #2c3e50;
            display: block;
        }
        
        .stat-label {
            color: #7f8c8d;
            font-size: 0.9rem;
            margin-top: 5px;
        }
        
        .legend {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .legend h3 {
            font-size: 1.2rem;
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .legend-items {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 2px solid;
        }
        
        .legend-color.main { background: #e3f2fd; border-color: #2196f3; }
        .legend-color.sub { background: #f1f8e9; border-color: #8bc34a; }
        .legend-color.sub-sub { background: #fff3e0; border-color: #ff9800; }
        .legend-color.sub-sub-sub { background: #fce4ec; border-color: #e91e63; }
        
        .legend-text {
            font-size: 0.9rem;
            color: #2c3e50;
        }
        
        .category-section {
            margin-bottom: 40px;
        }
        
        .category-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .category-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin: 0;
        }
        
        .category-description {
            margin: 5px 0 0 0;
            opacity: 0.9;
        }
        
        .projects-list {
            margin-top: 20px;
        }
        
        .project-sitemap-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }
        
        .project-sitemap-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #3498db;
        }
        
        .project-sitemap-card h3 {
            font-size: 1.4rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
        }
        
        .project-sitemap-card p {
            color: #7f8c8d;
            margin-bottom: 15px;
            font-size: 0.9rem;
        }
        
        .sitemap-preview {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 15px;
            background: #f8f9fa;
        }
        
        .sitemap-preview .hierarchy-node {
            margin: 5px 0;
            padding: 8px 12px;
            font-size: 0.85rem;
        }
        
        .sitemap-preview .hierarchy-node.main {
            background: #e3f2fd;
            border-color: #2196f3;
        }
        
        .sitemap-preview .hierarchy-node.sub {
            margin-left: 15px;
            background: #f1f8e9;
            border-color: #8bc34a;
        }
        
        .sitemap-preview .hierarchy-node.sub-sub {
            margin-left: 30px;
            background: #fff3e0;
            border-color: #ff9800;
        }
        
        .sitemap-preview .hierarchy-node.sub-sub-sub {
            margin-left: 45px;
            background: #fce4ec;
            border-color: #e91e63;
        }
        
        .code-sitemap {
            margin-top: 20px;
        }
        
        .code-sitemap h2 {
            font-size: 1.8rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .sitemap-code {
            background: #1e1e1e;
            color: #d4d4d4;
            font-family: 'Courier New', 'Monaco', 'Menlo', monospace;
            font-size: 14px;
            line-height: 1.6;
            padding: 25px;
            border-radius: 8px;
            border: 1px solid #333;
            overflow-x: auto;
            white-space: pre;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .code-line {
            margin: 0;
            padding: 2px 0;
            white-space: pre;
        }
        
        .code-line:empty {
            height: 1.6em;
        }
        
        @media (max-width: 768px) {
            .sitemap-container {
                padding: 15px;
            }
            
            .hierarchy-node.sub {
                margin-left: 20px;
            }
            
            .hierarchy-node.sub-sub {
                margin-left: 40px;
            }
            
            .hierarchy-node.sub-sub-sub {
                margin-left: 60px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
            
            .legend-items {
                grid-template-columns: 1fr;
            }
            
            .project-sitemap-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .project-sitemap-card {
                padding: 20px;
            }
            
            .sitemap-preview {
                max-height: 250px;
            }
        }
        </style>
    </head>
    <body>
        <div class="sitemap-container">
            <a href="../index.html" class="back-link">← Back to LifeOS</a>

            <header>
                <h1>Project Sitemap & Visual Hierarchy</h1>
                <p>Complete overview of all projects, ideas, and their
                    relationships across different aspects of life</p>
            </header>

            <div id="sitemapContent">
                <!-- Sitemap content will be loaded here -->
            </div>
        </div>

        <script>
        class SitemapPage {
            constructor() {
                this.allData = {};
                this.init();
            }

            async init() {
                await this.loadAllData();
                this.renderStats();
                this.renderSitemap();
            }

            async loadAllData() {
                try {
                    console.log('Loading barnacle projects...');
                    const barnacleProjects = await fetch('../data/barnacle-projects.json').then(r => r.json());
                    console.log('Loaded barnacle projects:', barnacleProjects);
                    this.allData = { barnacleProjects };
                } catch (error) {
                    console.error('Error loading data:', error);
                    this.showError('Failed to load project data.');
                }
            }

            renderStats() {
                const statsContainer = document.getElementById('statsGrid');
                statsContainer.innerHTML = '';
            }

            renderSitemap() {
                const container = document.getElementById('sitemapContent');
                
                container.innerHTML = `
                    <div class="code-sitemap">
                        <h2>Barnacle Films Project Sitemap</h2>
                        <div class="sitemap-code">
                            ${this.renderBarnacleCodeSitemap()}
                        </div>
                    </div>
                `;
            }

            renderGoalsHierarchy() {
                if (!this.allData.goals) return '<div class="hierarchy-node">No goals data available</div>';
                
                const categories = this.groupByCategory(this.allData.goals);
                
                return Object.entries(categories).map(([category, goals]) => `
                    <div class="hierarchy-node main">
                        <div class="node-title">${this.escapeHtml(category)}</div>
                        <div class="node-description">${goals.length} goals in this category</div>
                        <div class="node-meta">
                            <span class="node-tag">${goals.length} items</span>
                        </div>
                    </div>
                    ${goals.map(goal => `
                        <div class="hierarchy-node sub">
                            <div class="node-title">${this.escapeHtml(goal.title)}</div>
                            <div class="node-description">${this.escapeHtml(goal.description)}</div>
                            <div class="node-meta">
                                <span class="node-tag status-${goal.status?.toLowerCase().replace(' ', '-') || 'unknown'}">${this.escapeHtml(goal.status || 'Unknown')}</span>
                                <span class="node-tag priority-${goal.priority?.toLowerCase() || 'unknown'}">${this.escapeHtml(goal.priority || 'Unknown')}</span>
                            </div>
                        </div>
                    `).join('')}
                `).join('');
            }

            renderJobsHierarchy() {
                if (!this.allData.jobs) return '<div class="hierarchy-node">No jobs data available</div>';
                
                const organizations = this.groupByOrganization(this.allData.jobs);
                
                return Object.entries(organizations).map(([organization, jobs]) => `
                    <div class="hierarchy-node main">
                        <div class="node-title">${this.escapeHtml(organization)}</div>
                        <div class="node-description">${jobs.length} opportunities at this organization</div>
                        <div class="node-meta">
                            <span class="node-tag">${jobs.length} positions</span>
                        </div>
                    </div>
                    ${jobs.map(job => `
                        <div class="hierarchy-node sub">
                            <div class="node-title">${this.escapeHtml(job.title)}</div>
                            <div class="node-description">${this.escapeHtml(job.description)}</div>
                            <div class="node-meta">
                                <span class="node-tag">${this.escapeHtml(job.type || 'Unknown')}</span>
                                <span class="node-tag">${this.escapeHtml(job.location || 'Unknown')}</span>
                                ${job.url ? `<a href="${job.url}" class="node-link" target="_blank">View Job</a>` : ''}
                            </div>
                        </div>
                    `).join('')}
                `).join('');
            }

            renderWritingHierarchy() {
                if (!this.allData.writing) return '<div class="hierarchy-node">No writing data available</div>';
                
                const categories = this.groupByCategory(this.allData.writing);
                
                return Object.entries(categories).map(([category, projects]) => `
                    <div class="hierarchy-node main">
                        <div class="node-title">${this.escapeHtml(category)}</div>
                        <div class="node-description">${projects.length} writing projects in this category</div>
                        <div class="node-meta">
                            <span class="node-tag">${projects.length} projects</span>
                        </div>
                    </div>
                    ${projects.map(project => `
                        <div class="hierarchy-node sub">
                            <div class="node-title">${this.escapeHtml(project.title)}</div>
                            <div class="node-description">${this.escapeHtml(project.description)}</div>
                            <div class="node-meta">
                                <span class="node-tag status-${project.status?.toLowerCase().replace(' ', '-') || 'unknown'}">${this.escapeHtml(project.status || 'Unknown')}</span>
                                <span class="node-tag">${this.escapeHtml(project.wordCount || 'Unknown word count')}</span>
                                ${project.filePath ? `<a href="${project.filePath}" class="node-link" target="_blank">View File</a>` : ''}
                            </div>
                        </div>
                    `).join('')}
                `).join('');
            }

            renderFilmProductsHierarchy() {
                if (!this.allData.filmProducts) return '<div class="hierarchy-node">No film products data available</div>';
                
                const categories = this.groupByCategory(this.allData.filmProducts);
                
                return Object.entries(categories).map(([category, products]) => `
                    <div class="hierarchy-node main">
                        <div class="node-title">${this.escapeHtml(category)}</div>
                        <div class="node-description">${products.length} products/services in this category</div>
                        <div class="node-meta">
                            <span class="node-tag">${products.length} items</span>
                        </div>
                    </div>
                    ${products.map(product => `
                        <div class="hierarchy-node sub">
                            <div class="node-title">${this.escapeHtml(product.title)}</div>
                            <div class="node-description">${this.escapeHtml(product.description)}</div>
                            <div class="node-meta">
                                <span class="node-tag status-${product.status?.toLowerCase().replace(' ', '-') || 'unknown'}">${this.escapeHtml(product.status || 'Unknown')}</span>
                                <span class="node-tag">${this.escapeHtml(product.type || 'Unknown')}</span>
                                <span class="node-tag">${this.escapeHtml(product.pricing || 'Unknown pricing')}</span>
                            </div>
                        </div>
                    `).join('')}
                `).join('');
            }

            renderBarnacleCodeSitemap() {
                console.log('Rendering barnacle code sitemap, allData:', this.allData);
                if (!this.allData.barnacleProjects || this.allData.barnacleProjects.length === 0) {
                    console.log('No barnacle projects data available');
                    return '<div class="code-line">// No Barnacle projects data available</div>';
                }
                
                const project = this.allData.barnacleProjects[0];
                
                return `
                    <div class="code-line">// Barnacle Films Project Sitemap</div>
                    <div class="code-line">// Generated: ${new Date().toISOString().split('T')[0]}</div>
                    <div class="code-line"></div>
                    
                    <div class="code-line">I. ${this.escapeHtml(project.project)}</div>
                    <div class="code-line">   A. Studio: ${this.escapeHtml(project.studio)}</div>
                    <div class="code-line">   B. Version: ${this.escapeHtml(project.version)}</div>
                    <div class="code-line">   C. Last Updated: ${this.escapeHtml(project.last_updated)}</div>
                    <div class="code-line"></div>
                    
                    <div class="code-line">II. Monetization Strategy</div>
                    <div class="code-line">   A. Goal: ${this.escapeHtml(project.monetization_strategy.goal)}</div>
                    <div class="code-line">   B. Model: ${this.escapeHtml(project.monetization_strategy.model)}</div>
                    <div class="code-line">   C. Versioning</div>
                    <div class="code-line">      1. Shared Codebase: ${project.monetization_strategy.versioning.shared_codebase ? 'true' : 'false'}</div>
                    <div class="code-line">      2. Platform Toggle: ${this.escapeHtml(project.monetization_strategy.versioning.platform_toggle)}</div>
                    <div class="code-line">      3. Conditional Logic: ${this.escapeHtml(project.monetization_strategy.versioning.conditional_logic)}</div>
                    <div class="code-line"></div>
                    
                    <div class="code-line">III. Platform Distribution</div>
                    ${Object.entries(project.monetization_strategy.platforms).map(([platform, details], index) => `
                        <div class="code-line">   ${String.fromCharCode(65 + index)}. ${this.escapeHtml(platform)}</div>
                        <div class="code-line">      1. Price: ${this.escapeHtml(details.price)}</div>
                        <div class="code-line">      2. Ads Enabled: ${details.ads_enabled ? 'true' : 'false'}</div>
                        ${details.distribution ? `<div class="code-line">      3. Distribution: [${details.distribution.map(d => `"${d}"`).join(', ')}]</div>` : ''}
                        ${details.platforms ? `<div class="code-line">      3. Platforms: [${details.platforms.map(p => `"${p}"`).join(', ')}]</div>` : ''}
                        ${details.ad_frequency_minutes ? `<div class="code-line">      4. Ad Frequency: ${details.ad_frequency_minutes} minutes</div>` : ''}
                        ${details.ad_type ? `<div class="code-line">      5. Ad Type: ${this.escapeHtml(details.ad_type)}</div>` : ''}
                        ${details.monetization ? `<div class="code-line">      6. Monetization: ${this.escapeHtml(details.monetization)}</div>` : ''}
                        ${details.remove_ads_upgrade ? `
                            <div class="code-line">      7. Remove Ads Upgrade</div>
                            <div class="code-line">         a. Price: $${details.remove_ads_upgrade.price_usd}</div>
                            <div class="code-line">         b. Entitlement: ${this.escapeHtml(details.remove_ads_upgrade.entitlement_type || 'N/A')}</div>
                            <div class="code-line">         c. UI Location: ${this.escapeHtml(details.remove_ads_upgrade.ui_location || 'N/A')}</div>
                        ` : ''}
                        ${details.cross_promotion !== undefined ? `<div class="code-line">      8. Cross Promotion: ${details.cross_promotion ? 'true' : 'false'}</div>` : ''}
                        ${details.revenue_goal ? `<div class="code-line">      9. Revenue Goal: ${this.escapeHtml(details.revenue_goal)}</div>` : ''}
                        ${details.notes ? `<div class="code-line">      10. Notes: ${this.escapeHtml(details.notes)}</div>` : ''}
                        <div class="code-line"></div>
                    `).join('')}
                    
                    <div class="code-line">IV. Technical Implementation</div>
                    <div class="code-line">   A. Ad Delivery: ${this.escapeHtml(project.monetization_strategy.technical_notes.ad_delivery)}</div>
                    <div class="code-line">   B. Ad Client: ${this.escapeHtml(project.monetization_strategy.technical_notes.ad_client)}</div>
                    <div class="code-line">   C. Integration Point: ${this.escapeHtml(project.monetization_strategy.technical_notes.integration_point)}</div>
                    <div class="code-line">   D. Reward System: ${this.escapeHtml(project.monetization_strategy.technical_notes.reward_system)}</div>
                    <div class="code-line">   E. Platform Detection: ${this.escapeHtml(project.monetization_strategy.technical_notes.platform_detection)}</div>
                    <div class="code-line"></div>
                    
                    <div class="code-line">V. Player Experience</div>
                    <div class="code-line">   A. Ad Interruption Points: [${project.monetization_strategy.player_experience.ad_interruption_points.map(p => `"${p}"`).join(', ')}]</div>
                    <div class="code-line">   B. Skippable After: ${project.monetization_strategy.player_experience.skippable_after_seconds} seconds</div>
                    <div class="code-line">   C. Tone: ${this.escapeHtml(project.monetization_strategy.player_experience.tone)}</div>
                    <div class="code-line">   D. Premium Incentive: ${this.escapeHtml(project.monetization_strategy.player_experience.premium_incentive)}</div>
                    <div class="code-line">   E. Offline Mode: ${this.escapeHtml(project.monetization_strategy.player_experience.offline_mode)}</div>
                    <div class="code-line"></div>
                    
                    <div class="code-line">VI. Future Expansion</div>
                    <div class="code-line">   A. Sponsorship Model: ${this.escapeHtml(project.monetization_strategy.future_expansion.sponsorship_model)}</div>
                    <div class="code-line">   B. Cross Promotion: ${this.escapeHtml(project.monetization_strategy.future_expansion.cross_promo)}</div>
                    <div class="code-line">   C. Metrics: ${this.escapeHtml(project.monetization_strategy.future_expansion.metrics)}</div>
                    <div class="code-line">   D. Additional Revenue: [${project.monetization_strategy.future_expansion.additional_revenue.map(r => `"${r}"`).join(', ')}]</div>
                    <div class="code-line"></div>
                    
                    <div class="code-line">// End of sitemap</div>
                `;
            }

            groupByCategory(items) {
                return items.reduce((groups, item) => {
                    const category = item.category || 'Uncategorized';
                    if (!groups[category]) {
                        groups[category] = [];
                    }
                    groups[category].push(item);
                    return groups;
                }, {});
            }

            groupByOrganization(jobs) {
                return jobs.reduce((groups, job) => {
                    const org = job.organization || 'Unknown Organization';
                    if (!groups[org]) {
                        groups[org] = [];
                    }
                    groups[org].push(job);
                    return groups;
                }, {});
            }

            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            showError(message) {
                const container = document.querySelector('.sitemap-container');
                container.innerHTML = `
                    <div class="error-state">
                        <h2>Error</h2>
                        <p>${message}</p>
                        <button onclick="location.reload()">Reload Page</button>
                    </div>
                `;
            }
        }

        // Initialize the page when it loads
        document.addEventListener('DOMContentLoaded', () => {
            new SitemapPage();
        });
    </script>
    </body>
</html>
